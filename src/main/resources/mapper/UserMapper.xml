<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.cloud.activiti.mapper.UserMapper">

  <resultMap type="User" id="userMap">
    <id column="uid" property="uid"></id>
    <result column="username" property="username" />
    <result column="password" property="password" />
    <result column="tel" property="tel" />
    <result column="age" property="age" />
    <collection property="userRoles" column="userid" ofType="UserRole">
      <id property="urid" column="urid" />
      <association column="roleid" property="role" javaType="Role">
        <id column="rid" property="rid"></id>
        <result column="rolename" property="roleName" />
      </association>
    </collection>
  </resultMap>
  
  <select id="getUsers" resultMap="userMap">
    SELECT *
    FROM 
      t_user
    LEFT JOIN 
      t_user_role ON t_user.uid=t_user_role.userid
    LEFT JOIN 
      t_role ON t_user_role.roleid=t_role.rid
  </select>

  <select id="getUserById" resultMap="userMap">
    SELECT
      * 
    FROM
      t_user 
    LEFT JOIN
      t_user_role ON t_user.uid=t_user_role.userid 
    LEFT JOIN
      t_role ON t_user_role.roleid=t_role.rid
    WHERE 
      t_user.uid=#{uid}
  </select>

  <delete id="deleteUser" parameterType="int">
    DELETE FROM 
      t_user
    WHERE
      t_user.uid=#{uid}
  </delete>

  <delete id="deleteUserRole" parameterType="int">
    DELETE FROM 
      t_user_role 
    WHERE 
      t_user_role.userid=#{uid}
  </delete>

  <insert id="addUser" useGeneratedKeys="true" keyProperty="uid" parameterType="User">
    INSERT INTO 
      t_user (username,password,tel,age)
    VALUES
     (#{username},'1234',#{tel},#{age})
  </insert>

  <update id="updateUser" parameterType="User">
    UPDATE
      t_user
    SET
      tel=#{tel},age=#{age}
    WHERE 
      t_user.uid=#{uid}
  </update>

  <select id="getUidByUserName" resultType="int" parameterType="String">
    SELECT 
      uid
    FROM
      t_user 
    WHERE
      username=#{username}
  </select>
</mapper>